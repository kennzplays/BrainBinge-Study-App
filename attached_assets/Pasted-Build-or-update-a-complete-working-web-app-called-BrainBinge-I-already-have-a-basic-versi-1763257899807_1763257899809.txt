Build or update a complete, working web app called **â€œBrainBingeâ€**.

I already have a basic version working, but I want you to either regenerate or refactor it to match this exact spec.

---

ðŸŽ¯ GOAL

BrainBinge is a study + quiz web app that:

- Lets users pick or type a subject
- Lets users type a topic they want to learn
- Lets users type their **favorite anime / show**
- Uses AI to create:
  - Explanations that CONNECT the topic to that show
  - Quiz questions (free response and multiple-choice)
- Has a simple XP system to gamify learning
- Uses **LaTeX** for math
- Uses a **blue + white** color theme

The **main idea**: the AI must always relate the subject/topic to the userâ€™s chosen show/anime.

---

ðŸ§± TECH STACK & FILES

Use:

- Backend: **Python + Flask**
- Frontend: **HTML, CSS, JavaScript**
- Math rendering: **MathJax** (or KaTeX) on the frontend

Project files:

- `app.py` â€“ Flask app
- `templates/index.html` â€“ main UI
- `static/style.css` â€“ styles (blue/white theme)
- `static/script.js` â€“ frontend logic
- `requirements.txt` â€“ include `flask` and any AI libraries you use

The app must run in Replit by running `app.py`.

---

ðŸ–¥ UI REQUIREMENTS

On the main page (`index.html`), include:

1. **Subject selection:**
   - A row of subject buttons: â€œMathâ€, â€œEnglishâ€, â€œScienceâ€, â€œHistoryâ€, â€œProgrammingâ€
   - A text input labeled â€œCustom subjectâ€
   - Logic: if the user types a custom subject, use that instead of the buttons

2. **Topic input:**
   - A textarea: â€œWhat do you want to learn?â€ (e.g. â€œfactoring quadraticsâ€, â€œmitosisâ€, â€œthesis statementsâ€)

3. **Favorite show / anime input (IMPORTANT):**
   - A text input: â€œFavorite show or animeâ€
   - This must be sent to the backend and used in the AI prompt, so explanations and questions explicitly reference this show.

4. **Question type selection (NEW):**
   - A radio button or dropdown to choose:
     - â€œFree response questionsâ€
     - â€œMultiple-choice (A/B/C/D) questionsâ€
   - This affects how the quiz questions are generated.

5. **Two main action buttons (two modes):**
   - Button 1: **â€œGenerate Quiz Questionsâ€**
     - Uses subject + topic + show + selected question type
     - Generates questions only (no long explanation)
   - Button 2: **â€œBreakdown + Quizâ€**
     - First generates an explanation of the topic (connected to the show)
     - Then generates quiz questions at the end
     - Also respects the question type (free response vs multiple choice)

6. **XP display:**
   - A visible XP counter, e.g. â€œXP: 120â€
   - A simple level indicator, e.g. â€œLevel 3 â€“ Brain Bingerâ€
   - Optional: a simple progress bar

7. **Output area:**
   - A section where the explanation and questions are rendered
   - Must support LaTeX using MathJax, for both explanations and questions

---

ðŸ¤– BACKEND BEHAVIOR

In `app.py`:

- Route `GET /`:
  - Render `index.html`

- Route `POST /generate_quiz`:
  - Inputs from frontend:
    - `subject`
    - `topic`
    - `favorite_show`
    - `question_type` (e.g. "free" or "mcq")
  - Use AI (OpenAI API if possible) to generate **quiz-only** content.

- Route `POST /breakdown_quiz`:
  - Inputs:
    - `subject`
    - `topic`
    - `favorite_show`
    - `question_type`
  - Use AI to generate:
    - A **concept breakdown** that explains the topic
    - The explanation must **relate to the favorite show/anime** via characters, scenes, power systems, etc.
    - Then generate quiz questions based on that breakdown.

If you cannot actually call external APIs in this environment, create a stub function that returns example data, but structure it as if it were real AI responses.

---

ðŸ“š AI PROMPT LOGIC (IMPORTANT)

Whatever AI client you use, the prompt MUST:

- Use:
  - Subject
  - Topic
  - Favorite show
  - Question type
  - Mode (quiz-only or breakdown+quiz)

Template guideline:

> "You are an educational tutor that always relates concepts to the student's favorite show or anime.  
> Subject: {subject}  
> Topic: {topic}  
> Favorite show or anime: {favorite_show}  
> Question type: {question_type}  
> Mode: {mode} (either 'quiz_only' or 'breakdown_quiz')  
>
> Always explain or ask questions by connecting the topic to the characters, world, and themes of {favorite_show}. For example, use training arcs, battles, character development, power systems, etc.  
>
> If mode is 'breakdown_quiz':
> 1. First give a clear, step-by-step breakdown of the topic in a section titled 'Concept Breakdown'. Use the show as an analogy without being cringe or confusing.
> 2. Then generate a section titled 'Quiz Questions'.
>
> If mode is 'quiz_only':
> - Only generate the 'Quiz Questions' section (no breakdown).
>
> If question_type is 'free':
> - Make 5â€“7 open-ended questions that require written explanation.
>
> If question_type is 'mcq':
> - Make 5â€“7 multiple-choice questions with options A, B, C, D for each, and indicate the correct answer.
>
> At the end, include an 'Answers' section with the correct answers.
>
> For math topics, use LaTeX syntax for expressions, wrapped in \\( ... \\) or $$ ... $$ so it can be rendered by MathJax."

The backend should return structured text that the frontend can display directly.

---

ðŸŽ® XP SYSTEM

In `script.js`:

- Use `localStorage` to store XP.
- Award XP:
  - +10 XP when `/generate_quiz` succeeds
  - +15 XP when `/breakdown_quiz` succeeds
- Levels:
  - Level = floor(XP / 50) + 1
  - Optional titles:
    - Level 1: "Brain Rookie"
    - Level 2: "Study Starter"
    - Level 3: "Quiz Grinder"
    - Level 4+: "Brain Binger"
- Update XP and level on the page after each successful request.

---

ðŸŽ¨ BLUE + WHITE THEME

In `style.css`:

- Main colors:
  - Background: white or very light blue
  - UI accents: different blues
  - Text: dark navy or black
- Rounded buttons and cards
- Hover effects on subject buttons and main action buttons
- Responsive layout (at least looks fine on desktop and smaller screens)

---

ðŸ§® MATHJAX / LATEX

- Include MathJax via CDN in `index.html`.
- After inserting new content into the output area, trigger MathJax to re-render so any LaTeX is displayed properly.
- Both explanations and quiz questions may contain LaTeX.

---

âœ… FINAL

Generate or refactor all the necessary files (`app.py`, `templates/index.html`, `static/style.css`, `static/script.js`, `requirements.txt`) so the app:

- Runs with `python app.py` in Replit
- Lets the user:
  - pick or type a subject
  - enter a topic
  - enter their favorite show/anime
  - choose question type (free response or multiple choice)
  - click "Generate Quiz Questions" or "Breakdown + Quiz"
- Shows results related to their chosen show/anime
- Awards XP and updates level
- Properly displays math using LaTeX + MathJax.